# 클라우드 개발자 양성과정

## 상용 클라우드를 이용한 어플리케이션 배포
[소스코드](https://github.com/namgonkim/msa-ecommerce-tmax)
* 토이 프로젝트를 통한 msa 어플리케이션 실습
    - Docker 간 네트워크
    - 도커 레지스트리

## 도커 간 네트워크
* Bridge network
* Host network
* None network
* Container network
* Overlay network

### 브릿지 네트워크 생성
> docker network create [network name]

### 브릿지 연결과 해제
* 브릿지 네트워크를 새로 connect하면 기존의 브릿지와 함께 연결되어 있음
* docker network connect my-network service-discovery
* docker network disconnect bridge service-discovery

#### mariadb 컨테이너 외부 컨테이너(서비스 디스커버리)에서 접속
> 매번 바뀌는 브릿지 네트워크 ip를 접속하려 할때 이 ip 주소를 쓰는 것 대신 컨테이너 name을 작성해 접속
* mysql -hmariadb1 -uroot -p

## 도커 레지스트리
* private 저장 장소

#### 이미지 다운 및 실행
* docker pull registry
* docker run -d -p 5000:5000 --restart always --name registry registry:latest

#### 레지스트리 저장
* docker image tag {hub-id}/mydb localhost:5000/mydb:latest

#### 레지스트리 푸시
* docker push localhost:5000/mydb:latest

#### 레지스트리 목록 확인
* curl -X GET http://localhost:5000/v2/_catalog

## 외부 클라우드에 있는 레지스트리 -> 도커로 연결
* 인증받은 사용자들만 사용할 수 있음!
1. aws - ecr 서비스 - 레파지토리 생성
2. 생성된 레파지토리 주소 복사
3. docker tag {hub-id}/service-discovery {IAM사용자번호}.dkr.ecr.{지역코드}.amazonaws.com

### ECR (aws 클라우드 레파지토리)
* aws에 있는 ECR 비밀번호 코드를 들고 도커 ECR 레파지토리 접속
> aws ecr get-login-password --region {지역코드} | docker login --username AWS --password-stdin {IAM사용자번호}.dkr.ecr.{지역코드}.amazonaws.com

#### 도커 -> 클라우드 레파지토리(ECR) 이미지 업로드
* Tag 이미지 만들기
> docker tag {hub-id}/mydb {aws-iam-id}.dkr.ecr.{aws-region}.amazonaws.com/{aws-user-id}/mydb

* 클라우드에 올리기
> docker push {aws-iam-id}.dkr.ecr.{aws-region}.amazonaws.com/{aws-user-id}/mydb

* 클라우드 레파지토리에서 도커로 pull
> docker pull {aws-iam-id}.dkr.ecr.{aws-region}.amazonaws.com/{aws-user-id}/mydb