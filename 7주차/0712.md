# 클라우드 개발자 양성과정

## 오라클 데이터베이스
* DML
* TCL
* DDL
* DCL

### DML
* DATA MANIPULATION LANGUAGE
* 데이터 조작 명령어

#### INSERT
- 단일 행 INSERT문은 VALUES절을 포함하며,  한 번에 한 건만 입력된다.

  INSERT INTO 테이블명 [(컬럼1, 칼럼2, .......)] VALUES (값1, 값2, ....)
   
- 칼럼명과 VALUES 절의 값을 서로 1:1로 매핑해 기술한다.
- PRIMARY KEY 제약 또는 NOT NULL 제약이 지정된 칼럼은 NULL값 입력울 허용하지
  않으므로 오류가 발생한다.
- 해당 칼럼의 데이터유형이 CHAR, VARCHAR 일 경우 '' 함께 값을 입력한다.

[예제]  선수 테이블에 박지성 선수의 데이터를 일부 칼럼만 입력한다.

```sql
INSERT INTO PLAYER (PLAYER_ID, PLAYER_NAME, TEAM_ID, POSITION,
                              HEIGHT, WEIGHT, BACK_NO)
VALUES
('2002007', '박지성', 'K07', 'MF', 178, 73, 7);

SELECT  *
 FROM  PLAYER
WHERE PLAYER_NAME='박지성';
```

- INTO 절의 칼럼명은 생략 할 수 있다. INTO절 칼럼명을 지정하지 않는 경우, 테이블에
  정의된 칼럼순서 대로 VLUES 절에 모든값을 빠짐없이 기술해야 한다.
- INTO 절의 칼럼명을  지정하는 편이 쿼리의 안정성 측면에서 바람직하다.


#### UPDATE
 - UPDATE 다음에 수정되어야 할 칼럼이 존재하는 테이블명을 입력하고 SET 다음에
  수정되어야 할 칼럼명과 해당 칼럼에 수정되는 값으로 수정이 이루어진다.
```
  UPDATE  테이블명
         SET 수정할 칼럼명1 = 수정될 새로운 값1
         [ ,   수정할 칼럼명2 = 수정될 새로운 값2]
         [ ,   ............                                      ]
  [WHERE 수정 대상 식별 조건식 ];
  ```
#### DELETE  
 
- 테이블의 정보가 필요 없게 되었을 경우 데이터 삭제를 수행한다.
- DELETE FROM 테이블명을 입력하고 실행한다.
- WHERE 절을 사용하지 않는다면 테이블의 전체 데이터가 삭제된다.
```
  DELETE  [FROM]  테이블명
 [WHERE  삭제 대상 식별 조건식];
```
[예제]선수 테이블의 데이터를 전부 삭제한다.
  - 모든 행이 삭제된다.
```sql
  DELETE FROM PLAYER; 
```
[예제]선수 테이블에서 포지션이 'DF'이고, 입단년도가 2010년 이전인 선수의
       데이터를 삭제 한다.
```sql
 DELETE  PLAYER
 WHERE  POSITION = 'DF'
     AND  JOIN_YYYY < 2010;
```
* DELETE 문의 WHERE 절에 서브쿼리를 사용
  - 다른 테이블을 참조해 삭제할 행을 식별할 수 있다.

#### MERGE
- 새로운 행을 입력하거나, 기존 행을 수정하는 작업을 한 번에 할 수 있다.
- MERGE 다음에 입력/수정돼야 할 타겟 테이블을 입력하고, 
  USING 절에 입력/수정에 사용할 소스 테이블을 입력한다.
  ON 절에는 타겟 테이블과 소스테이블간의 조인 조건식을 기술해, 입력/수정할
       대상을 결정한다.
- ON 절의 조인 조건에 따라 조인에 성공한 행들에 대해서는 WHEN MATHCED THEN
  아래 UPDATE구문을 수행하고, 조인에 실패한 행들에 대해 WHEN NOT MATHCED
  THEN 아래 INSERT구문을 수행한다.
  
```
   MERGE
      INTO 타겟 테이블명
    USING 소스 테이블명    
        ON (조인 조건식)
    WHEN MATCHED THEN
        UPDATE
             SET  수정할 칼럼명1 = 수정될 새로운 값1
            [ ,     수정할 칼럼명2 = 수정될 새로운 값2, ....]
    WHEN NOT MATCHED THEN
         INSERT [(칼럼1, 칼럼2, .....)]
         VALUES (값1, 값2, .....,)
     ;
```

* DDL과 DML 처리 방식
- DDL(CREATE, ALTER, RENAME, DROP) 명령어의 경우,데이터 구조 변경이 
  DDL 명령어 수행이 완료됨과 동시에 즉시 반영된다.
- DML(INSERT, UPDATE, DELETE, SELECT) 명령어 사용 시 데이터 변경 사항을 테이블에
  영구적으로 저장하기 위해서는 COMMIT 명령어를 수행해 TRANSACTION을 종료해야
  한다
  
### 트랜잭션
- 트랜잭션은 데이터베이스의 논리적 연산단위다.
- 트랜잭션(TRANSACTION)이란 밀접히 관련돼 분리될 수 없는 한 개 이상의
  데이터베이스 조작을 가리킨다.
- 하나의 트랜잭션에는 하나 이상의 SQL 문장이 포함된다.
- 트랜잭션은 분할할 수 없는 최소의 단위이다. 그러므로 전부 적용하거나
  전부 취소한다.
- 은행에서의 계좌이체 상황을 연상하면 트랜잭션을 이해하는데 도움이 된다.
- 계좌이체는 최소한 두 가지 이상의 작업으로 이루어져 있다. 

### TCL
1) 커밋(COMMIT) : 올바르게 반영된 데이터를 데이터베이스에 반영시키는 것을 말한다.
 2) 롤백(ROLLBACK) : 트랜잭션 시작 이전의 상태로 되돌리는 것이다.
 3) 저장점(SAVEPOINT) : 트랜잭션의 일부만 취소할 수 있게 만드는 명령어이다.  

#### COMMIT
- 입력,수정,삭제한 자료에 대해 전혀 문제가 없다고 판단됐을 경우
  COMMIT 명령어를 통해서 트랜잭션을 완료할 수 있다.

* COMMIT이나 ROLLBACK 이전의 데이터 상태는 다음과 같다.  
   
   - 데이터의 변경을 취소해 이전 상태로 복구 가능하다.
   - 현재 사용자는 SELECT 문장으로 결과를 확인 가능하다.
   - 다른 사용자는 현재 사용자가 수행한 명령의 결과를 볼 수 없다.
   - 변경된 행은 잠금(LOCKING)이 설정되어서 다른 사용자가 변경할 수 없다.


#### ROLLBACK

- 테이블 내 입력한 데이터나, 수정한 데이터, 삭제한 데이터에 대하여
  COMMIT 이전에는 변경 사항을 취소할 수 있는데 데이터베이스에서는
  롤백(ROLLBACK) 기능을 사용한다.
- 롤백(ROLLBACK)은 데이터 변경 사항이 취소돼 데이터가 이전 상태로 복구되며,
  관련된 행에 대한 잠금(LOCKING)이 풀리고 다른 사용자들이 데이터 변경을
  할 수 있게 된다.
  
  
#### SAVEPOINT

- 저장점(SAVEPOINT)을 정의하면 롤백(ROLLBACK)할 때 트랜잭션에 포함된
  전체 작업을 롤백하는 것이 아니라 현 시점에서 SAVEPOINT까지 트랜잭션의
  일부만 롤백할 수 있다.
- 복잡한 대규모 트랜잭션에서 에러가 발생했을 때 SAVEPOINT까지의 트랜잭션만
  롤백하고 실패한 부분에 대해서만 다시 실행할 수 있다.
- 복수의 저장점을 정의할 수 있으며, 동일이름으로 저장점을 정의했을 때는
  나중에 정의한 저장점이 유효하다.
  
  
### DDL
* DATA DEFINITION LANGUAGE

#### CREATE TABLE

(1) 테이블과 컬럼의 정의 
- 테이블에 존재하는 모든 데이터를 고유하게 식별할 수 있으면서 반드시 값이 존재하는
  기본키 칼럼을 지정한다.
- 선수 테이블을 예로 들면 ‘선수ID’ 칼럼이 기본키로 적당하다.
- 기본키는 단일 칼럼이 아닌 여러 개의 칼럼으로 구성될 수 있다(복합키).
- 테이블과 테이블 간에 정의된 관계는 기본키(PRIMARY KEY)와 외부키(FOREIGN KEY)를
  활용해서 설정하도록 한다.
- 이상 현상을 방지하기 위해 팀 정보를 관리하는 팀 테이블을 별도로 분리해서 팀ID와
  팀이름을 저장하고, 선수 테이블에서는 팀ID를 외부키로 참조하게 한다. 


#### ALTER TABLE
- 컬럼의 추가/삭제 및 제약조건 추가/삭제를 한다.

* ADD COLUMN
  - 기존 테이블에 필요한 칼럼을 추가하는 명령어이다.
```
ALTER  TABLE  테이블명
             ADD(  추가할 컬럼명1 데이터유형  [기본값]  [NOT NULL]
                             [ , 추가할 컬럼명1 데이터유형  [기본값]  [NOT NULL]
                     ,  .......] );
```

#### DROP COLUMN
  
 - 테이블에서 필요 없는 칼럼을 삭제할 수 있으며 데이터가 있거나 없거나
   모두 삭제 가능하다.
```
ALTER  TABLE  테이블명 DROP COLUMN ( 삭제할 칼럼명1 [, 삭제할 칼럼명2, ........] );
```

### DCL
* DATA CONTROL LANGUAGE
* 유저를 생성하고 권한을 제어할 수 있는 명령어


- 새로운 유저를 생성하고, 생성한 유저에게 공유할 테이블이나 기타 오브젝트에
  대한 접근 권한만을 부여할 수 있다.
- 대부분의 데이터베이스는 데이터 보호와 보안을 위해서 유저와 권한을
  관리하고 있다.
- Oracle을 설치하면 기본적으로 제공되는 유저들은 아래와 같다.
- OracleXE 는 SCOTT/TIGER 계정 없음.


(1) 유저 생성과 시스템 권한 부여
 - 유저를 생성하고 데이터베이스에 접속한다. 하지만 접속했더라도 테이블, 뷰,
   인덱스 등과 같은 오브젝트(OBJECT)를 생성할 수는 없다.
 - 사용자가 실행하는 모든 DDL 문장(CREATE, ALTER, DROP, RENAME 등)은
    그에 해당하는 적절한 권한이 있어야만 문장을 실행할 수 있다.
 - 이런 권한을 시스템 권한이라고 하며 약 100개 이상의 종류가 있다.
   100개 이상의 시스템 권한을 일일이 사용자에게 설정하는 것은 너무 복잡하고,
   특히 유저로부터 권한을 관리하기 어렵다.
 - 롤(ROLE)을 이용하여 간편하고 쉽게 권한을 부여한다.
 - 새로운 유저를 생성하려면 유저 생성 권한(CREATE USER)이 있어야 한다.
